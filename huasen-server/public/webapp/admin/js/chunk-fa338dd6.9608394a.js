(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-fa338dd6"],{"7db0":function(t,e,a){"use strict";var i=a("23e7"),o=a("b727").find,n=a("44d2"),r=!0;"find"in[]&&Array(1).find((function(){r=!1})),i({target:"Array",proto:!0,forced:r},{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n("find")},"7f4f":function(t,e,a){},f6af:function(t,e,a){"use strict";a.r(e);var i=a("5530"),o=a("2909"),n=(a("7db0"),a("d81d"),a("b0c0"),a("159b"),a("ca7f")),r=a("102f"),l=a("dc92"),s={name:"TakeManage",components:{TableList:n.a,DialogForm:r.a},data:function(){return{total:0,tableData:[],tableMap:[{label:"网站名称",key:"name"},{label:"网站链接",key:"url"},{label:"网站描述",key:"description"},{label:"网站图标",key:"icon"},{label:"备注",key:"remarks"},{label:"拓展字段",key:"expand"},{label:"权限码",key:"code"},{label:"是否可用",key:"enabled"}],searchForm:{name:"",code:""},searchFormMap:[{label:"名称",type:"input",key:"name"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code}],show:!1,showImport:!1,mode:"add",importMode:"add",formMap:[{label:"名称",key:"name",type:"input"},{label:"链接",key:"url",type:"input"},{label:"图标",key:"icon",type:"icon"},{label:"描述",key:"description",type:"input"},{label:"是否可用",key:"enabled",type:"switch"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code},{label:"网站标签",key:"siteTag",type:"select",selectOptions:[],selectConfig:{"allow-create":!0,filterable:!0,multiple:!0}},{label:"备注",key:"remarks",type:"input"},{label:"拓展字段",key:"expand",type:"input"}],importFormMap:[{label:"网站标签",key:"siteTag",type:"select",selectOptions:[],selectConfig:{"allow-create":!0,filterable:!0,multiple:!0}},{label:"所属栏目",key:"columnId",type:"select",selectOptions:[],selectConfig:{filterable:!0,multiple:!0}},{label:"网站数据",key:"siteData",type:"textarea"}],rule:{name:[{validator:Object(l.b)(["isNoEmpty::必填项","minLength:2::长度不能小于2","maxLength:20::长度不能大于20"]),trigger:"blur"}],url:[{validator:Object(l.b)(["isNoEmpty::必填项","isUrl::请输入正确的网址"]),trigger:"blur"}],expand:[{validator:Object(l.b)(["isJSONObject::请输入JSON对象"]),trigger:"blur"}]},importRule:{siteData:[{validator:Object(l.b)(['isSiteList::格式：[{"name":"名称","url":"http://huasen.cc","description":"描述"}]']),trigger:"blur"}]},form:{name:"",url:"",icon:"",description:"",remarks:"",expand:"{}",enabled:!0,code:0,siteTag:[]},importForm:{siteTag:[],columnId:[],siteData:""},pageNo:1,pageSize:10}},mounted:function(){this.queryData(),this.queryColumnData()},methods:{queryData:function(){var t=this,e=Object.assign({pageNo:this.pageNo,pageSize:this.pageSize},this.searchForm);this.API.findSiteByPage(e,{notify:!1}).then((function(e){t.tableData=e.data.list,t.total=e.data.total,t.cancel()})),this.API.findSiteTagByList({},{notify:!1}).then((function(e){var a=t.formMap.find((function(t){return"siteTag"===t.key})),i=t.importFormMap.find((function(t){return"siteTag"===t.key})),n=e.data.map((function(t){return{label:t,value:t}}));a&&(a.selectOptions=Object(o.a)(n)),i&&(i.selectOptions=Object(o.a)(n))}))},queryColumnData:function(){var t=this;this.API.findColumnByList({},{notify:!1}).then((function(e){var a=t.importFormMap.find((function(t){return"columnId"===t.key}));a&&(a.selectOptions=e.data.map((function(t){return{label:t.name,value:t._id}})))}))},updatePagination:function(t,e){this.pageNo=t,this.pageSize=e},handleRemove:function(t,e){var a=this;this.API.removeSite({_id:e._id}).then((function(t){a.queryData()}))},handleRemoveMany:function(t){var e=this,a=t.map((function(t){return t._id}));this.API.removeManySite({_ids:a}).then((function(t){e.queryData()}))},handleAdd:function(){this.show=!0,this.mode="add"},handleAddMany:function(){this.showImport=!0},handleEdit:function(t,e){var a=this;this.show=!0,this.mode="edit",this.$nextTick((function(){var t=[];try{t=JSON.parse(e.expand||"{}").tag||[]}catch(t){a.$tips("error","数据处理失败","top-right",1200)}a.form=Object.assign(a.form,e,{siteTag:t})}))},paginationChange:function(){this.queryData()},save:function(){var t=this,e=Object(i.a)({},this.form);try{var a=JSON.parse(e.expand||"{}");a.tag=e.siteTag;var o=JSON.stringify(a);e.expand=o}catch(t){}"edit"===this.mode?this.API.updateSite(e).then((function(e){t.queryData()})):"add"===this.mode&&(delete e._id,delete e._v,this.API.addSite(e).then((function(e){t.queryData()})))},saveImportSite:function(){var t=this,e=Object(i.a)({},this.importForm);try{var a=JSON.parse(e.siteData);a.forEach((function(t){if(e.siteTag.length){var a={};a.tag=e.siteTag,t.expand=JSON.stringify(a)}})),this.API.addManySite({sites:a}).then((function(a){var i=a.data.map((function(t){return t._id}));t.queryData(),t.bindSiteToColumn(e.columnId,i),t.cancelImportSite()}))}catch(t){this.$tips("error","数据格式非法","top-right",1200)}},bindSiteToColumn:function(t,e){t.length&&e.length&&this.API.bindSiteToColumn({columnIds:t,siteIds:e},{notify:!1})},cancelImportSite:function(){this.$refs.dialogImportForm&&this.$refs.dialogImportForm.close(),this.showImport=!1},cancel:function(){this.$refs.dialogForm&&this.$refs.dialogForm.close(),this.show=!1}}},c=(a("f89c"),a("2877")),d=Object(c.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"site-manage"},[a("TableList",{attrs:{tableData:t.tableData,tableMap:t.tableMap,formData:t.searchForm,formMap:t.searchFormMap,total:t.total,showAdd:!0,showAddMany:!0,showSelection:!0},on:{"update:formData":function(e){t.searchForm=e},"update:form-data":function(e){t.searchForm=e},edit:t.handleEdit,add:t.handleAdd,addMany:t.handleAddMany,remove:t.handleRemove,removeMany:t.handleRemoveMany,search:t.queryData,paginationChange:t.paginationChange,updatePagination:t.updatePagination}}),t.show?a("DialogForm",{ref:"dialogForm",attrs:{width:"520",maxHeight:"480",title:"add"==t.mode?"添加网链":"编辑网链",visible:t.show,formMap:t.formMap,formData:t.form,formRule:t.rule,"close-on-click-modal":!1,mode:t.mode,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(e){t.show=e},"update:formData":function(e){t.form=e},"update:form-data":function(e){t.form=e},comfirmForm:t.save,cancelForm:t.cancel}}):t._e(),t.showImport?a("DialogForm",{ref:"dialogImportForm",attrs:{width:"420",maxHeight:"480",title:"导入站点",visible:t.showImport,formMap:t.importFormMap,formData:t.importForm,formRule:t.importRule,"close-on-click-modal":!1,mode:t.importMode,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(e){t.showImport=e},"update:formData":function(e){t.importForm=e},"update:form-data":function(e){t.importForm=e},comfirmForm:t.saveImportSite,cancelForm:t.cancelImportSite}}):t._e()],1)}),[],!1,null,"57362f61",null);e.default=d.exports},f89c:function(t,e,a){"use strict";a("7f4f")}}]);