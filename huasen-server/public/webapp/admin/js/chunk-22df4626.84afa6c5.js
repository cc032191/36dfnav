(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-22df4626","chunk-58ade8c8"],{"15f6":function(e,t,a){"use strict";a.r(t);var i=a("2909"),s=(a("4de4"),a("caad"),a("2532"),a("b0c0"),a("159b"),a("a434"),a("d81d"),a("b76a")),n=a.n(s),r={name:"SiteSelector",components:{HsDrawer:a("1feb").a,Draggable:n.a},props:{currentColumn:{type:Object,default:function(){}}},data:function(){return{searchText:"",searchType:"siteName",selectSites:[],selectSiteIndex:[],sites:[]}},computed:{displaySites:function(){var e=this;return"tag"===this.searchType?this.searchText?this.sites.filter((function(t){if(t.expand&&"{}"!==t.expand)try{return JSON.parse(t.expand).tag.some((function(a){if(a.toUpperCase().includes(e.searchText.toUpperCase()))return t.targetTagName=a,!0}))}catch(e){console.log("标签筛选异常")}})):this.sites:this.sites.filter((function(t){return t.name.toUpperCase().includes(e.searchText.toUpperCase())}))},searchPlaceholderText:function(){return"请输入"+("tag"===this.searchType?"标签":"网站")+"名称"},showTag:function(){return this.searchText&&"tag"===this.searchType}},watch:{selectSiteIndex:function(){this.handleSelectSite()},sites:function(){this.handleSelectSite()},currentColumn:{handler:function(e,t){try{this.selectSiteIndex=Array.isArray(JSON.parse(e.siteStore))?Object(i.a)(JSON.parse(e.siteStore)):[]}catch(e){this.selectSiteIndex=[]}},deep:!0,immediate:!0}},mounted:function(){this.querySite()},methods:{querySite:function(){var e=this;this.API.findSiteByList({},{notify:!1}).then((function(t){e.sites=t.data}))},handleSelectSite:function(){var e=this,t=[];this.selectSiteIndex.forEach((function(a){e.sites.some((function(e){if(e._id===a)return t.push(e),!0}))})),this.selectSites=t},getSelectStatus:function(e){return this.selectSiteIndex.includes(e._id)},imgUrl:function(e){return e.icon?e.icon:a("4101")},selectSite:function(e){var t=e._id,a=this.selectSiteIndex.indexOf(t);-1===a?this.selectSiteIndex.push(t):this.selectSiteIndex.splice(a,1)},save:function(){var e=this,t=this.selectSites.map((function(e){return e._id}));this.API.updateColumn({_id:this.currentColumn._id,siteStore:JSON.stringify(t)}).then((function(t){e.$emit("save")}))},cancel:function(){this.$emit("cancel"),this.$emit("update:visible",!1)},remove:function(e,t){var a=this.selectSiteIndex.indexOf(e._id);-1!==a&&this.selectSiteIndex.splice(a,1)}}},o=(a("dcb1"),a("2877")),c=Object(o.a)(r,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("HsDrawer",e._g(e._b({},"HsDrawer",e.$attrs,!1),e.$listeners),[a("div",{staticClass:"site-selector"},[a("div",{staticClass:"site-selector-main"},[a("div",{staticClass:"selected"},[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[e._v("已选择")])]),a("ul",{staticClass:"site-list"},[a("Draggable",{attrs:{filter:".no-drap",animation:"400"},model:{value:e.selectSites,callback:function(t){e.selectSites=t},expression:"selectSites"}},[a("transition-group",e._l(e.selectSites,(function(t,i){return a("li",{key:t._id,staticClass:"site-item drag-item"},[a("i",{staticClass:"el-icon-rank pointer"}),a("div",{staticClass:"name text no-drap"},[e._v(e._s(e._f("emptyTip")(t.name)))]),a("div",{staticClass:"description text no-drap"},[e._v(e._s(e._f("emptyTip")(t.description)))]),a("i",{staticClass:"el-icon-delete pointer remove no-drap",on:{click:function(a){return e.remove(t,i)}}})])})),0)],1)],1)]),a("div",{staticClass:"selecting"},[a("div",{staticClass:"header"},[a("div",{staticClass:"title"},[e._v("待选择")]),a("div",{staticClass:"search"},[a("el-select",{model:{value:e.searchType,callback:function(t){e.searchType=t},expression:"searchType"}},[a("el-option",{attrs:{label:"标签名",value:"tag"}}),a("el-option",{attrs:{label:"网站名",value:"siteName"}})],1),a("el-input",{attrs:{placeholder:e.searchPlaceholderText,"suffix-icon":"el-icon-search"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1)]),a("ul",{staticClass:"site-group"},e._l(e.displaySites,(function(t){return a("li",{key:t._id,staticClass:"site",class:{active:e.getSelectStatus(t)},on:{click:function(a){return e.selectSite(t)}}},[a("div",{staticClass:"icon-group"},[a("img",{directives:[{name:"lazy",rawName:"v-lazy"}],attrs:{src:e.imgUrl(t)}})]),a("div",{staticClass:"text-group"},[a("div",{staticClass:"name text",attrs:{title:t.name}},[e._v(e._s(e._f("emptyTip")(t.name)))]),a("div",{staticClass:"description text",attrs:{title:t.description}},[e._v(e._s(e._f("emptyTip")(e.showTag?t.targetTagName:t.description)))])])])})),0)])]),a("div",{staticClass:"site-selector-footer"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.save}},[e._v("确定配置")]),a("el-button",{attrs:{type:"warning",plain:""},on:{click:e.cancel}},[e._v("取消修改")])],1)])])}),[],!1,null,"24049886",null);t.default=c.exports},"227b":function(e,t,a){},"57c3":function(e,t,a){"use strict";a.r(t);var i=a("5530"),s=a("ca7f"),n=a("102f"),r=a("15f6"),o=a("dc92"),c={name:"ColumnManage",components:{TableList:s.a,DialogForm:n.a,SiteSelector:r.default},data:function(){return{total:0,tableData:[],tableMap:[{label:"栏目名称",key:"name"},{label:"描述",key:"description"},{label:"封面",key:"banner"},{label:"备注",key:"remarks"},{label:"网址仓库",key:"siteStore"},{label:"拓展字段",key:"expand"},{label:"权限码",key:"code"},{label:"是否可用",key:"enabled"}],searchForm:{name:"",code:""},searchFormMap:[{label:"名称",type:"input",key:"name"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code}],show:!1,showSiteSelector:!1,mode:"add",formMap:[{label:"栏目名称",key:"name",type:"input"},{label:"描述",key:"description",type:"input"},{label:"封面",key:"banner",type:"banner"},{label:"备注",key:"remarks",type:"input"},{label:"网址仓库",key:"siteStore",type:"input"},{label:"拓展字段",key:"expand",type:"input"},{label:"权限码",key:"code",type:"select",selectOptions:this.CONSTANT.dictionary.code},{label:"是否可用",key:"enabled",type:"switch"}],rule:{name:[{validator:Object(o.b)(["isNoEmpty::必填项","minLength:2::长度不能小于2","maxLength:20::长度不能大于20"]),trigger:"blur"}],url:[{validator:Object(o.b)(["isNoEmpty::必填项","isUrl::请输入正确的网址"]),trigger:"blur"}],siteStore:[{validator:Object(o.b)(["isJSONArray::请输入JSON数组"]),trigger:"blur"}],expand:[{validator:Object(o.b)(["isJSONObject::请输入JSON对象"]),trigger:"blur"}]},form:{name:"",siteStore:"[]",description:"",banner:"",remarks:"",expand:"{}",enabled:!0,code:0},currentColumn:{},pageNo:1,pageSize:10}},mounted:function(){this.queryData()},methods:{queryData:function(){var e=this,t=Object.assign({pageNo:this.pageNo,pageSize:this.pageSize},this.searchForm);this.API.findColumnByPage(t,{notify:!1}).then((function(t){e.tableData=t.data.list,e.total=t.data.total,e.cancel()}))},updatePagination:function(e,t){this.pageNo=e,this.pageSize=t},handleRemove:function(e,t,a,i){var s=this;this.API.removeColumn({_id:t._id}).then((function(e){s.queryData()}))},handleAdd:function(){this.show=!0,this.mode="add"},handleEdit:function(e,t){var a=this;this.show=!0,this.mode="edit",this.$nextTick((function(){a.form=Object.assign(a.form,t)}))},handleOperate:function(e,t){this.showSiteSelector=!0,this.currentColumn=Object(i.a)({},t)},paginationChange:function(){this.queryData()},save:function(){var e=this;"edit"===this.mode?this.API.updateColumn(this.form).then((function(t){e.queryData()})):"add"===this.mode&&(delete this.form._id,delete this.form._v,this.API.addColumn(this.form).then((function(t){e.queryData()})))},handleColumnSave:function(){this.showSiteSelector=!1,this.queryData()},cancel:function(){this.$refs.dialogForm&&this.$refs.dialogForm.close(),this.show=!1}}},l=(a("fc38"),a("2877")),d=Object(l.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"column-manage"},[a("TableList",{attrs:{tableData:e.tableData,tableMap:e.tableMap,formData:e.searchForm,formMap:e.searchFormMap,total:e.total,showAdd:!0,showOperate:!0},on:{"update:formData":function(t){e.searchForm=t},"update:form-data":function(t){e.searchForm=t},operate:e.handleOperate,edit:e.handleEdit,add:e.handleAdd,remove:e.handleRemove,search:e.queryData,paginationChange:e.paginationChange,updatePagination:e.updatePagination}}),e.show?a("DialogForm",{ref:"dialogForm",attrs:{width:"460",title:"add"==e.mode?"添加栏目":"编辑栏目",visible:e.show,formMap:e.formMap,formData:e.form,formRule:e.rule,mode:e.mode,buttons:{comfirm:"确 认",cancel:"取 消"}},on:{"update:visible":function(t){e.show=t},"update:formData":function(t){e.form=t},"update:form-data":function(t){e.form=t},comfirmForm:e.save,cancelForm:e.cancel}}):e._e(),e.showSiteSelector?a("SiteSelector",{attrs:{title:"配置栏目",size:"500",visible:e.showSiteSelector,currentColumn:e.currentColumn},on:{"update:visible":function(t){e.showSiteSelector=t},save:e.handleColumnSave}}):e._e()],1)}),[],!1,null,"46b32381",null);t.default=d.exports},a0d6:function(e,t,a){},dcb1:function(e,t,a){"use strict";a("a0d6")},fc38:function(e,t,a){"use strict";a("227b")}}]);